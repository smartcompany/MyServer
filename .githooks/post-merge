#!/bin/bash

# Git pull í›„ ìë™ìœ¼ë¡œ ë¹Œë“œ ë° ì¬ì‹œì‘í•˜ëŠ” hook

echo "ğŸ”„ Git pull ì™„ë£Œ, ìë™ ì¬ì‹œì‘ ì‹œì‘..."

# PM2ê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
if ! command -v pm2 &> /dev/null; then
    echo "âš ï¸  PM2ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. ìŠ¤í‚µí•©ë‹ˆë‹¤."
    exit 0
fi

# Next.js ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
if pm2 list | grep -q "nextjs-server"; then
    echo "ğŸ“¦ ì˜ì¡´ì„± í™•ì¸ ì¤‘..."
    npm install --production
    
    echo "ğŸ”¨ Next.js ë¹Œë“œ ì¤‘..."
    npm run build
    
    echo "ğŸ”„ Next.js ì„œë²„ ì¬ì‹œì‘ ì¤‘..."
    pm2 restart nextjs-server
    
    echo "âœ… ìë™ ì¬ì‹œì‘ ì™„ë£Œ!"
else
    echo "â„¹ï¸  nextjs-serverê°€ ì‹¤í–‰ ì¤‘ì´ ì•„ë‹ˆë¯€ë¡œ ìŠ¤í‚µí•©ë‹ˆë‹¤."
fi

