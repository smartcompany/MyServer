<!DOCTYPE html>
<html>
<head><title>트레이딩 설정</title></head>
<body>
  <h3>김치 프리미엄 기준 설정</h3>
  매수 기준: <input id="buy" type="number" step="0.01"><br>
  매도 기준: <input id="sell" type="number" step="0.01"><br>
  <button onclick="updateConfig()">설정 적용</button>

  <h3>최근 로그</h3>
  <pre id="logArea">불러오는 중...</pre>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      fetch('/trade-api/config')
        .then(response => response.json())
        .then(data => {
          const buyThreshold = data.buyThreshold;
          const sellThreshold = data.sellThreshold;
          document.getElementById('buy').value = buyThreshold;
          document.getElementById('sell').value = sellThreshold;
        });
    });

    async function updateConfig() {
      const buy = parseFloat(document.getElementById('buy').value);
      const sell = parseFloat(document.getElementById('sell').value);

      await fetch('/trade-api/config', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          updates: [
            { key: 'buyThreshold', value: buy },
            { key: 'sellThreshold', value: sell }
          ]
        })
      });

      alert('설정이 반영되었습니다');
    }

    // 로그 주기적으로 갱신
    setInterval(async () => {
      const res = await fetch('/trade-api/logs');
      const text = await res.text();
      document.getElementById('logArea').textContent = text;
    }, 5000);
  </script>
</body>
</html>
